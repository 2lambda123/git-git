but-cummit-graph(1)
===================

NAME
----
but-cummit-graph - Write and verify Git cummit-graph files


SYNOPSIS
--------
[verse]
'but cummit-graph verify' [--object-dir <dir>] [--shallow] [--[no-]progress]
'but cummit-graph write' <options> [--object-dir <dir>] [--[no-]progress]


DESCRIPTION
-----------

Manage the serialized cummit-graph file.


OPTIONS
-------
--object-dir::
	Use given directory for the location of packfiles and cummit-graph
	file. This parameter exists to specify the location of an alternate
	that only has the objects directory, not a full `.but` directory. The
	cummit-graph file is expected to be in the `<dir>/info` directory and
	the packfiles are expected to be in `<dir>/pack`. If the directory
	could not be made into an absolute path, or does not match any known
	object directory, `but cummit-graph ...` will exit with non-zero
	status.

--[no-]progress::
	Turn progress on/off explicitly. If neither is specified, progress is
	shown if standard error is connected to a terminal.

COMMANDS
--------
'write'::

Write a cummit-graph file based on the cummits found in packfiles. If
the config option `core.cummitGraph` is disabled, then this command will
output a warning, then return success without writing a cummit-graph file.
+
With the `--stdin-packs` option, generate the new cummit graph by
walking objects only in the specified pack-indexes. (Cannot be combined
with `--stdin-cummits` or `--reachable`.)
+
With the `--stdin-cummits` option, generate the new cummit graph by
walking cummits starting at the cummits specified in stdin as a list
of OIDs in hex, one OID per line. OIDs that resolve to non-cummits
(either directly, or by peeling tags) are silently ignored. OIDs that
are malformed, or do not exist generate an error. (Cannot be combined
with `--stdin-packs` or `--reachable`.)
+
With the `--reachable` option, generate the new cummit graph by walking
cummits starting at all refs. (Cannot be combined with `--stdin-cummits`
or `--stdin-packs`.)
+
With the `--append` option, include all cummits that are present in the
existing cummit-graph file.
+
With the `--changed-paths` option, compute and write information about the
paths changed between a cummit and its first parent. This operation can
take a while on large repositories. It provides significant performance gains
for getting history of a directory or a file with `but log -- <path>`. If
this option is given, future cummit-graph writes will automatically assume
that this option was intended. Use `--no-changed-paths` to stop storing this
data.
+
With the `--max-new-filters=<n>` option, generate at most `n` new Bloom
filters (if `--changed-paths` is specified). If `n` is `-1`, no limit is
enforced. Only cummits present in the new layer count against this
limit. To retroactively compute Bloom filters over earlier layers, it is
advised to use `--split=replace`.  Overrides the `cummitGraph.maxNewFilters`
configuration.
+
With the `--split[=<strategy>]` option, write the cummit-graph as a
chain of multiple cummit-graph files stored in
`<dir>/info/cummit-graphs`. cummit-graph layers are merged based on the
strategy and other splitting options. The new cummits not already in the
cummit-graph are added in a new "tip" file. This file is merged with the
existing file if the following merge conditions are met:
+
* If `--split=no-merge` is specified, a merge is never performed, and
the remaining options are ignored. `--split=replace` overwrites the
existing chain with a new one. A bare `--split` defers to the remaining
options. (Note that merging a chain of cummit graphs replaces the
existing chain with a length-1 chain where the first and only
incremental holds the entire graph).
+
* If `--size-multiple=<X>` is not specified, let `X` equal 2. If the new
tip file would have `N` cummits and the previous tip has `M` cummits and
`X` times `N` is greater than  `M`, instead merge the two files into a
single file.
+
* If `--max-cummits=<M>` is specified with `M` a positive integer, and the
new tip file would have more than `M` cummits, then instead merge the new
tip with the previous tip.
+
Finally, if `--expire-time=<datetime>` is not specified, let `datetime`
be the current time. After writing the split cummit-graph, delete all
unused cummit-graph whose modified times are older than `datetime`.

'verify'::

Read the cummit-graph file and verify its contents against the object
database. Used to check for corrupted data.
+
With the `--shallow` option, only check the tip cummit-graph file in
a chain of split cummit-graphs.


EXAMPLES
--------

* Write a cummit-graph file for the packed cummits in your local `.but`
  directory.
+
------------------------------------------------
$ but cummit-graph write
------------------------------------------------

* Write a cummit-graph file, extending the current cummit-graph file
  using cummits in `<pack-index>`.
+
------------------------------------------------
$ echo <pack-index> | but cummit-graph write --stdin-packs
------------------------------------------------

* Write a cummit-graph file containing all reachable cummits.
+
------------------------------------------------
$ but show-ref -s | but cummit-graph write --stdin-cummits
------------------------------------------------

* Write a cummit-graph file containing all cummits in the current
  cummit-graph file along with those reachable from `HEAD`.
+
------------------------------------------------
$ but rev-parse HEAD | but cummit-graph write --stdin-cummits --append
------------------------------------------------


BUT
---
Part of the linkbut:but[1] suite
